// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || '';
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY || '';

// æ£€æŸ¥çŽ¯å¢ƒå˜é‡
if (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {
  const errorMsg = 'âŒ Supabase çŽ¯å¢ƒå˜é‡æœªé…ç½®ï¼\n\n' +
    'è¯·åœ¨ Vercel Dashboard æˆ–æœ¬åœ° .env æ–‡ä»¶ä¸­é…ç½®ï¼š\n' +
    '- VITE_SUPABASE_URL\n' +
    '- VITE_SUPABASE_PUBLISHABLE_KEY\n\n' +
    'å½“å‰çŠ¶æ€ï¼š\n' +
    `- VITE_SUPABASE_URL: ${SUPABASE_URL ? 'âœ…' : 'âŒ ç¼ºå¤±'}\n` +
    `- VITE_SUPABASE_PUBLISHABLE_KEY: ${SUPABASE_PUBLISHABLE_KEY ? 'âœ…' : 'âŒ ç¼ºå¤±'}`;
  
  console.error(errorMsg);
  
  // åœ¨å¼€å‘çŽ¯å¢ƒä¸‹æ˜¾ç¤ºè­¦å‘Š
  if (import.meta.env.DEV) {
    alert(errorMsg);
  }
}

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

// å³ä½¿çŽ¯å¢ƒå˜é‡ç¼ºå¤±ï¼Œä¹Ÿåˆ›å»ºå®¢æˆ·ç«¯ï¼ˆé¿å…åº”ç”¨å´©æºƒï¼‰ï¼Œä½†ä¼šåœ¨è°ƒç”¨æ—¶å¤±è´¥
// æ£€æŸ¥ key æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ ¼å¼
const isValidKey = (key: string) => {
  if (!key || key === 'placeholder-key') return false;
  // Supabase anon key é€šå¸¸æ˜¯ JWT tokenï¼Œä»¥ eyJ å¼€å¤´
  return key.startsWith('eyJ') || key.startsWith('sb_publishable_');
};

export const supabase = createClient<Database>(
  SUPABASE_URL || 'https://placeholder.supabase.co',
  SUPABASE_PUBLISHABLE_KEY || 'placeholder-key',
  {
    auth: {
      storage: localStorage,
      persistSession: true,
      autoRefreshToken: true,
    }
  }
);

// éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§å¹¶åœ¨æŽ§åˆ¶å°æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
if (SUPABASE_URL && SUPABASE_PUBLISHABLE_KEY) {
  console.log('ðŸ” Supabase é…ç½®æ£€æŸ¥:');
  console.log('  - URL:', SUPABASE_URL);
  console.log('  - Key å‰ç¼€:', SUPABASE_PUBLISHABLE_KEY.substring(0, 30) + '...');
  console.log('  - Key é•¿åº¦:', SUPABASE_PUBLISHABLE_KEY.length);
  console.log('  - URL æ ¼å¼:', SUPABASE_URL.startsWith('https://') ? 'âœ…' : 'âŒ');
  console.log('  - Key æ ¼å¼:', isValidKey(SUPABASE_PUBLISHABLE_KEY) ? 'âœ…' : 'âŒ');
  
  if (!SUPABASE_URL.startsWith('https://') || SUPABASE_URL.includes('placeholder')) {
    console.warn('âš ï¸ VITE_SUPABASE_URL æ ¼å¼å¯èƒ½ä¸æ­£ç¡®:', SUPABASE_URL);
  }
  if (!isValidKey(SUPABASE_PUBLISHABLE_KEY)) {
    console.warn('âš ï¸ VITE_SUPABASE_PUBLISHABLE_KEY æ ¼å¼å¯èƒ½ä¸æ­£ç¡®ã€‚åº”è¯¥æ˜¯ä»¥ "eyJ" å¼€å¤´çš„ JWT token æˆ– "sb_publishable_" å¼€å¤´çš„ key');
  }
} else {
  console.error('âŒ Supabase çŽ¯å¢ƒå˜é‡ç¼ºå¤±:', {
    hasUrl: !!SUPABASE_URL,
    hasKey: !!SUPABASE_PUBLISHABLE_KEY,
    url: SUPABASE_URL || 'æœªè®¾ç½®',
    keyPrefix: SUPABASE_PUBLISHABLE_KEY ? SUPABASE_PUBLISHABLE_KEY.substring(0, 20) + '...' : 'æœªè®¾ç½®'
  });
}

// å¯¼å‡ºé…ç½®æ£€æŸ¥å‡½æ•°
export const isSupabaseConfigured = () => {
  return !!(SUPABASE_URL && SUPABASE_PUBLISHABLE_KEY && 
           !SUPABASE_URL.includes('placeholder') && 
           !SUPABASE_PUBLISHABLE_KEY.includes('placeholder'));
};